// Configuration Firebase - Ã€ COMPLÃ‰TER AVEC VOS VRAIES VALEURS
const firebaseConfig = {
  apiKey: "COLLEZ-VOTRE-API-KEY-ICI",
  authDomain: "COLLEZ-VOTRE-AUTH-DOMAIN-ICI",
  projectId: "COLLEZ-VOTRE-PROJECT-ID-ICI",
  storageBucket: "COLLEZ-VOTRE-STORAGE-BUCKET-ICI",
  messagingSenderId: "COLLEZ-VOTRE-SENDER-ID-ICI",
  appId: "COLLEZ-VOTRE-APP-ID-ICI"
};

// SGA - SystÃ¨me de Gestion des Agents avec Firebase
class SGASystem {
    constructor() {
        this.agents = [];
        this.currentPage = 'dashboard';
        this.initFirebase();
    }

    async initFirebase() {
        // Initialiser Firebase
        const app = firebase.initializeApp(firebaseConfig);
        this.db = firebase.firestore(app);
        this.init();
    }

    async init() {
        this.setupEventListeners();
        await this.loadAgentsFromFirebase();
        this.displayAgents();
    }

    setupEventListeners() {
        const navButtons = document.querySelectorAll('.nav-btn');
        navButtons.forEach(btn => {
            btn.addEventListener('click', (e) => {
                this.switchPage(e.target.dataset.page);
            });
        });

        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('action-btn')) {
                this.addNewAgent();
            }
        });
    }

    async loadAgentsFromFirebase() {
        try {
            const snapshot = await this.db.collection('agents').get();
            this.agents = [];
            snapshot.forEach(doc => {
                this.agents.push({ id: doc.id, ...doc.data() });
            });
            
            if (this.agents.length === 0) {
                // Ajouter des donnÃ©es exemple si vide
                await this.addSampleData();
            }
        } catch (error) {
            console.error("Erreur Firebase:", error);
        }
    }

    async addSampleData() {
        const sampleAgents = [
            { name: 'Jean Dupont', role: 'Agent de sÃ©curitÃ©', present: true },
            { name: 'Marie Martin', role: 'Superviseur', present: true },
            { name: 'Pierre Lambert', role: 'Agent de terrain', present: false }
        ];

        for (const agent of sampleAgents) {
            await this.db.collection('agents').add(agent);
        }
        
        await this.loadAgentsFromFirebase();
    }

    switchPage(page) {
        this.currentPage = page;
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.classList.remove('active');
            if (btn.dataset.page === page) {
                btn.classList.add('active');
            }
        });
        this.updateContent();
    }

    updateContent() {
        const content = document.querySelector('.main-content');
        if (this.currentPage === 'agents') {
            content.innerHTML = this.getAgentsPageHTML();
        } else if (this.currentPage === 'planning') {
            content.innerHTML = this.getPlanningPageHTML();
        } else {
            content.innerHTML = this.getDashboardHTML();
        }
    }

    getDashboardHTML() {
        return `
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Agents Actifs</h3>
                    <p class="stat-number">${this.agents.length}</p>
                </div>
                <div class="stat-card">
                    <h3>PrÃ©sents Aujourd'hui</h3>
                    <p class="stat-number">${this.agents.filter(a => a.present).length}</p>
                </div>
            </div>
            
            <div class="quick-actions">
                <h3>Actions Rapides</h3>
                <button class="action-btn">Nouvel Agent</button>
            </div>
        `;
    }

    getAgentsPageHTML() {
        return `
            <div class="page-header">
                <h2>Gestion des Agents</h2>
                <button class="action-btn" style="width: auto;">+ Ajouter Agent</button>
            </div>
            <div class="agents-list">
                ${this.agents.map(agent => `
                    <div class="agent-card">
                        <h4>${agent.name}</h4>
                        <p>${agent.role}</p>
                        <span class="status ${agent.present ? 'present' : 'absent'}">
                            ${agent.present ? 'ðŸŸ¢ PrÃ©sent' : 'ðŸ”´ Absent'}
                        </span>
                        <button onclick="app.deleteAgent('${agent.id}')" class="delete-btn">Supprimer</button>
                    </div>
                `).join('')}
            </div>
        `;
    }

    getPlanningPageHTML() {
        return `
            <div class="page-header">
                <h2>Planning</h2>
            </div>
            <div class="planning-grid">
                <p>FonctionnalitÃ© planning en dÃ©veloppement...</p>
            </div>
        `;
    }

    displayAgents() {
        const statNumber = document.querySelector('.stat-number');
        if (statNumber) {
            statNumber.textContent = this.agents.length;
        }
    }

    async addNewAgent() {
        const name = prompt('Nom du nouvel agent:');
        if (name) {
            const role = prompt('RÃ´le de l\'agent:') || 'Nouvel agent';
            try {
                await this.db.collection('agents').add({
                    name: name,
                    role: role,
                    present: true,
                    created_at: new Date()
                });
                await this.loadAgentsFromFirebase();
                this.updateContent();
                alert(`Agent ${name} ajoutÃ© avec succÃ¨s!`);
            } catch (error) {
                alert('Erreur lors de l\'ajout: ' + error.message);
            }
        }
    }

    async deleteAgent(agentId) {
        if (confirm('Supprimer cet agent ?')) {
            try {
                await this.db.collection('agents').doc(agentId).delete();
                await this.loadAgentsFromFirebase();
                this.updateContent();
            } catch (error) {
                alert('Erreur lors de la suppression: ' + error.message);
            }
        }
    }
}

// Initialiser l'application
let app;
document.addEventListener('DOMContentLoaded', () => {
    app = new SGASystem();
});
